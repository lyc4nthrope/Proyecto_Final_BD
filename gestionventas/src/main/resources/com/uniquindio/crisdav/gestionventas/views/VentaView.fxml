<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.RadioButton?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Spinner?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>


<ScrollPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.uniquindio.crisdav.gestionventas.controllers.views.VentaViewController">
   <content>
      <VBox spacing="15" style="-fx-padding: 20;">
      
          <!-- Título -->
          <HBox alignment="CENTER_LEFT" spacing="10">
              <Label style="-fx-font-size: 24; -fx-font-weight: bold;" text="💰 Nueva Venta" />
          </HBox>
          
          <Separator />
      
          <!-- Información del Cliente -->
          <VBox spacing="10" style="-fx-border-color: #dee2e6; -fx-border-radius: 5; -fx-padding: 15;">
              <Label style="-fx-font-size: 16; -fx-font-weight: bold;" text="Información del Cliente" />
              
              <HBox alignment="CENTER_LEFT" spacing="10">
                  <Label style="-fx-min-width: 100;" text="Cédula:" />
                  <TextField fx:id="txtCedulaCliente" prefWidth="200" promptText="Buscar por cédula" />
                  <Button onAction="#buscarCliente" style="-fx-background-color: #007bff; -fx-text-fill: white;" text="🔍 Buscar" />
                  <Button onAction="#nuevoCliente" style="-fx-background-color: #28a745; -fx-text-fill: white;" text="➕ Nuevo Cliente" />
              </HBox>
              
              <GridPane hgap="10" vgap="10">
                  <Label style="-fx-font-weight: bold;" text="Nombre:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                  <Label fx:id="lblNombreCliente" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                  
                  <Label style="-fx-font-weight: bold;" text="Teléfono:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                  <Label fx:id="lblTelefonoCliente" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                  
                  <Label style="-fx-font-weight: bold;" text="Crédito Activo:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                  <Label fx:id="lblCreditoActivo" text="-" GridPane.columnIndex="3" GridPane.rowIndex="0" />
               <columnConstraints>
                  <ColumnConstraints />
                  <ColumnConstraints />
                  <ColumnConstraints />
                  <ColumnConstraints />
               </columnConstraints>
               <rowConstraints>
                  <RowConstraints />
                  <RowConstraints />
               </rowConstraints>
              </GridPane>
          </VBox>

          <!-- Selección de Vendedor -->
            <VBox spacing="10" style="-fx-border-color: #dee2e6; -fx-border-radius: 5; -fx-padding: 15;">
                <Label text="Vendedor Asignado" style="-fx-font-size: 16; -fx-font-weight: bold;"/>
                
                <!-- Para Administradores: ComboBox de selección -->
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="Vendedor:" style="-fx-min-width: 100; -fx-font-weight: bold;"/>
                    <ComboBox fx:id="comboVendedor" prefWidth="300" promptText="Seleccione un vendedor"/>
                    <Label text="(Solo administradores pueden cambiar)" style="-fx-font-size: 10; -fx-text-fill: #666;"/>
                </HBox>
                
                <!-- Para Paramétricos: Label informativo -->
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label fx:id="lblVendedorInfo" text="Vendedor asignado automáticamente" 
                        style="-fx-font-size: 13; -fx-text-fill: #007bff; -fx-font-weight: bold;"/>
                </HBox>
            </VBox>
      
          <!-- Tipo de Venta -->
          <HBox alignment="CENTER_LEFT" spacing="20">
              <Label style="-fx-font-size: 14; -fx-font-weight: bold;" text="Tipo de Venta:" />
              <RadioButton fx:id="rbContado" selected="true" text="Contado">
               <toggleGroup>
                  <ToggleGroup fx:id="tipoVenta" />
               </toggleGroup>
            </RadioButton>
              <RadioButton fx:id="rbCredito" text="Crédito" toggleGroup="$tipoVenta" />
              
              <Region HBox.hgrow="ALWAYS" />
              
              <!-- Cuotas (solo visible para crédito) -->
              <Label fx:id="lblCuotas" managed="false" text="Número de Cuotas:" visible="false" />
              <ComboBox fx:id="comboCuotas" managed="false" prefWidth="100" visible="false" />
          </HBox>
      
          <!-- Agregar Productos -->
          <VBox spacing="10" style="-fx-border-color: #dee2e6; -fx-border-radius: 5; -fx-padding: 15;">
              <Label style="-fx-font-size: 16; -fx-font-weight: bold;" text="Agregar Productos" />
              
              <HBox alignment="CENTER_LEFT" spacing="10">
                  <Label style="-fx-min-width: 80;" text="Código:" />
                  <TextField fx:id="txtCodigoProducto" prefWidth="150" promptText="Código del producto" />
                  <Button onAction="#buscarProducto" style="-fx-background-color: #007bff; -fx-text-fill: white;" text="🔍" />
                  
                  <Label style="-fx-min-width: 80;" text="Cantidad:" />
                  <Spinner fx:id="spinCantidad" editable="true" prefWidth="100" />
                  
                  <Button onAction="#agregarProducto" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-font-weight: bold;" text="➕ Agregar" />
              </HBox>
              
              <HBox spacing="10">
                  <Label style="-fx-font-weight: bold;" text="Producto:" />
                  <Label fx:id="lblProductoSeleccionado" text="Ninguno" />
                  <Region HBox.hgrow="ALWAYS" />
                  <Label style="-fx-font-weight: bold;" text="Precio:" />
                  <Label fx:id="lblPrecioProducto" text=" $0.00" />
                  <Label style="-fx-font-weight: bold;" text="Stock:" />
                  <Label fx:id="lblStockProducto" text="0" />
              </HBox>
          </VBox>
      
          <!-- Tabla de Productos -->
          <VBox spacing="5" VBox.vgrow="ALWAYS">
              <Label style="-fx-font-size: 14; -fx-font-weight: bold;" text="Productos en la Venta" />
              <TableView fx:id="tablaProductos" VBox.vgrow="ALWAYS">
                  <columns>
                      <TableColumn fx:id="colCodigo" prefWidth="100" text="Código" />
                      <TableColumn fx:id="colNombre" prefWidth="250" text="Producto" />
                      <TableColumn fx:id="colCantidad" prefWidth="80" text="Cantidad" />
                      <TableColumn fx:id="colPrecio" prefWidth="120" text="Precio Unit." />
                      <TableColumn fx:id="colIva" prefWidth="80" text="IVA" />
                      <TableColumn fx:id="colSubtotal" prefWidth="120" text="Subtotal" />
                      <TableColumn fx:id="colAcciones" prefWidth="100" text="Acciones" />
                  </columns>
              </TableView>
              <Button onAction="#eliminarProducto" style="-fx-background-color: #dc3545; -fx-text-fill: white;" text="🗑️ Eliminar Seleccionado" />
          </VBox>
      
          <!-- Totales -->
          <VBox spacing="5" style="-fx-border-color: #28a745; -fx-border-width: 2; -fx-border-radius: 5; -fx-padding: 15; -fx-background-color: #f8f9fa;">
              <HBox spacing="20">
                  <Region HBox.hgrow="ALWAYS" />
                  <VBox alignment="CENTER_RIGHT" spacing="5">
                      <HBox spacing="10">
                          <Label style="-fx-font-size: 14; -fx-font-weight: bold;" text="Subtotal:" />
                          <Label fx:id="lblSubtotal" style="-fx-font-size: 14;" text=" $0.00" />
                      </HBox>
                      <HBox spacing="10">
                          <Label style="-fx-font-size: 14; -fx-font-weight: bold;" text="IVA:" />
                          <Label fx:id="lblIva" style="-fx-font-size: 14;" text=" $0.00" />
                      </HBox>
                      <Separator prefWidth="200" />
                      <HBox spacing="10">
                          <Label style="-fx-font-size: 20; -fx-font-weight: bold; -fx-text-fill: #28a745;" text="TOTAL:" />
                          <Label fx:id="lblTotal" style="-fx-font-size: 20; -fx-font-weight: bold; -fx-text-fill: #28a745;" text=" $0.00" />
                      </HBox>
                      
                      <!-- Info Crédito -->
                      <VBox fx:id="infoCreditoBox" managed="false" spacing="5" style="-fx-border-color: #ffc107; -fx-border-width: 1; -fx-padding: 10; -fx-background-color: #fff3cd;" visible="false">
                          <HBox spacing="10">
                              <Label style="-fx-font-weight: bold;" text="Cuota Inicial (30%):" />
                              <Label fx:id="lblCuotaInicial" text=" $0.00" />
                          </HBox>
                          <HBox spacing="10">
                              <Label style="-fx-font-weight: bold;" text="Saldo a Financiar (70% + 5%):" />
                              <Label fx:id="lblSaldoFinanciar" text=" $0.00" />
                          </HBox>
                          <HBox spacing="10">
                              <Label style="-fx-font-weight: bold;" text="Valor Cuota Mensual:" />
                              <Label fx:id="lblValorCuota" text=" $0.00" />
                          </HBox>
                      </VBox>
                  </VBox>
              </HBox>
          </VBox>
      
          <!-- Botones de Acción -->
          <HBox alignment="CENTER" spacing="10">
              <Button onAction="#procesarVenta" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-font-size: 16; -fx-font-weight: bold; -fx-padding: 10 30;" text="💾 Procesar Venta" />
              <Button onAction="#limpiarFormulario" style="-fx-background-color: #6c757d; -fx-text-fill: white; -fx-font-size: 16; -fx-padding: 10 30;" text="🧹 Limpiar" />
              <Button onAction="#cancelar" style="-fx-background-color: #dc3545; -fx-text-fill: white; -fx-font-size: 16; -fx-padding: 10 30;" text="❌ Cancelar" />
          </HBox>
      
      </VBox>
   </content>
</ScrollPane>
